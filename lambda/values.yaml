# AWS Lambda Scope Configuration
#
# Required environment variables (set in Helm values):
#   AWS_REGION               - AWS region for Lambda deployment
#   TOFU_STATE_BUCKET        - S3 bucket for Terraform state
#   TOFU_STATE_REGION        - Region for Terraform state bucket
#
# Optional environment variables:
#   DOMAIN                   - Base domain for scope URLs (e.g., nullapps.io)
#   USE_ACCOUNT_SLUG         - Include account slug in domain (default: true)
#   USE_NULL_AGENT           - Enable nullplatform agent layer (default: true)
#   NULL_AGENT_LAYER_ARN     - ARN of nullplatform agent Lambda layer
#   RESOURCE_TAGS_JSON       - JSON object with resource tags

provider_categories:
  - cloud-providers
  - assets-repository

configuration:
  # Terraform Configuration
  TOFU_PATH: "$SERVICE_PATH/deployment"

  # Domain Configuration
  DOMAIN: "nullapps.io"
  USE_ACCOUNT_SLUG: false

  # Lambda Agent Layer (for observability)
  USE_NULL_AGENT: true
  # NULL_AGENT_LAYER_ARN: "arn:aws:lambda:us-east-1:123456789012:layer:nullplatform-agent:1"

  # Default Lambda Settings
  DEFAULT_RUNTIME: "nodejs20.x"
  DEFAULT_HANDLER: "index.handler"
  DEFAULT_MEMORY: 256
  DEFAULT_TIMEOUT: 30
  DEFAULT_ARCHITECTURE: "arm64"
  DEFAULT_EPHEMERAL_STORAGE: 512

  # Concurrency Defaults
  DEFAULT_RESERVED_CONCURRENCY_TYPE: "unreserved"
  DEFAULT_PROVISIONED_CONCURRENCY_TYPE: "unprovisioned"

  # Warm Alias (for blue-green + provisioned concurrency)
  # LAMBDA_WARMUP_ALIAS_NAME: "warmup"

  # Deployment Settings
  DEPLOYMENT_MAX_WAIT_IN_SECONDS: 600
  PROVISIONED_CONCURRENCY_MAX_WAIT_SECONDS: 600
  PROVISIONED_CONCURRENCY_POLL_INTERVAL: 5

  # API Gateway Settings (for public visibility)
  API_GATEWAY_STAGE_NAME: "main"
  API_GATEWAY_THROTTLING_BURST_LIMIT: 5000
  API_GATEWAY_THROTTLING_RATE_LIMIT: 10000
  # ACM certificate ARN for API Gateway custom domain (required for HTTPS on custom domains)
  CERTIFICATE_ARN: "arn:aws:acm:us-east-1:688720756067:certificate/2dd64edf-e000-46cf-b38c-3bd4fca36522"

  # ALB Settings (for private visibility)
  # ALB_LISTENER_ARN: ""
  # ALB_LISTENER_RULE_PRIORITY_START: 100
  ALB_LISTENER_RULE_CAPACITY: 100
  ALB_LISTENER_RULE_ALERT_THRESHOLD: 80

  # CloudWatch Logs
  LOG_RETENTION_DAYS: 30

  # IAM Configuration
  # IAM role can be managed per-scope or per-deployment via NRN configuration
  # See aws_role_controller documentation for NRN keys:
  #   AWS_LAMBDA_USE_DEDICATED_ROLE: true/false
  #   AWS_LAMBDA_DEDICATED_ROLE_NAME_TEMPLATE: "lambda-{scope_slug}-{namespace_slug}"
  #   AWS_LAMBDA_DEDICATED_ROLE_POLICIES: JSON array of policy definitions
  #   AWS_LAMBDA_DEDICATED_ROLE_ENTITY: "scope" or "deployment"

  # Parameters Strategy: "env" (Lambda env vars) or "secretsmanager" (AWS Secrets Manager)
  PARAMETERS_STRATEGY: "env"

  # Placeholder Lambda (created during scope creation)
  PLACEHOLDER_LAMBDA_RUNTIME: "nodejs20.x"
  PLACEHOLDER_LAMBDA_HANDLER: "index.handler"
